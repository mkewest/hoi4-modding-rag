21:15:54 â¯ pytest tests
================================== test session starts ==================================
platform win32 -- Python 3.12.10, pytest-9.0.2, pluggy-1.6.0
rootdir: F:\Projects\HOI4\HOI4-RAG
configfile: pyproject.toml
plugins: anyio-4.12.0, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 8 items

tests\test_chunking.py .                                                           [ 12%]
tests\test_embeddings.py ..                                                        [ 37%]
tests\test_mcp_tools.py F                                                          [ 50%]
tests\test_retrieval.py .                                                          [ 62%]
tests\test_sparse_index.py ..                                                      [ 87%]
tests\test_vectordb.py .                                                           [100%]

======================================= FAILURES ========================================
___________________________ test_mcp_tools_search_and_section ___________________________

    def test_mcp_tools_search_and_section():
        server = create_server(settings=None, searcher=FakeSearcher(), reranker=FakeReranker())

        # search tool
        res = server.tools[0]("q", None, 3)  # type: ignore[index]
>       assert res and res[0]["chunk_id"] == "id"
                       ^^^^^^^^^^^^^^^^^^
E       KeyError: 'chunk_id'

tests\test_mcp_tools.py:59: KeyError
================================ short test summary info ================================
FAILED tests/test_mcp_tools.py::test_mcp_tools_search_and_section - KeyError: 'chunk_id'
============================== 1 failed, 7 passed in 6.80s ==============================
