============================================================== test session starts ==============================================================
platform win32 -- Python 3.12.10, pytest-9.0.2, pluggy-1.6.0
rootdir: F:\Projects\HOI4\HOI4-RAG
configfile: pyproject.toml
testpaths: tests
plugins: anyio-4.12.0, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 3 items / 4 errors

==================================================================== ERRORS =====================================================================
___________________________________________________ ERROR collecting tests/test_mcp_tools.py ____________________________________________________
tests\test_mcp_tools.py:1: in <module>
    from hoi4_rag.mcp_server import create_server
src\hoi4_rag\mcp_server\__init__.py:3: in <module>
    from .server import create_server
src\hoi4_rag\mcp_server\server.py:11: in <module>
    from hoi4_rag.retrieval import BGEReranker, HybridSearcher
src\hoi4_rag\retrieval\__init__.py:3: in <module>
    from .hybrid_search import HybridSearcher, RetrievalError
src\hoi4_rag\retrieval\hybrid_search.py:12: in <module>
    from hoi4_rag.vectordb import LanceDBStore, SearchResult, SparseIndex
src\hoi4_rag\vectordb\__init__.py:3: in <module>
    from .lancedb_store import DocumentChunk, LanceDBStore, SearchResult
src\hoi4_rag\vectordb\lancedb_store.py:19: in <module>
    class DocumentChunk(LanceModel):
.venv\Lib\site-packages\pydantic\_internal\_model_construction.py:255: in __new__
    complete_model_class(
.venv\Lib\site-packages\pydantic\_internal\_model_construction.py:648: in complete_model_class
    schema = gen_schema.generate_schema(cls)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:729: in generate_schema
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1023: in _generate_schema_inner
    return self._model_schema(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:856: in _model_schema
    {k: self._generate_md_field_schema(k, v, decorators) for k, v in fields.items()},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1228: in _generate_md_field_schema
    schema, metadata = self._common_field_schema(name, field_info, decorators)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1282: in _common_field_schema
    schema = self._apply_annotations(
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:2227: in _apply_annotations
    schema = get_inner_schema(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_schema_generation_shared.py:83: in __call__
    schema = self._handler(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:2206: in inner_handler
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1028: in _generate_schema_inner
    return self.match_type(obj)
           ^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1148: in match_type
    return self._unknown_type_schema(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:659: in _unknown_type_schema
    raise PydanticSchemaGenerationError(
E   pydantic.errors.PydanticSchemaGenerationError: Unable to generate pydantic-core schema for TimestampType(timestamp[us]). Set `arbitrary_types_allowed=True` in the model_config to ignore this error or implement `__get_pydantic_core_schema__` on your type to fully support it.
E
E   If you got this error by calling handler(<some type>) within `__get_pydantic_core_schema__` then you likely need to call `handler.generate_schema(<some type>)` since we do not call `__get_pydantic_core_schema__` on `<some type>` otherwise to avoid infinite recursion.
E
E   For further information visit https://errors.pydantic.dev/2.12/u/schema-for-unknown-type
___________________________________________________ ERROR collecting tests/test_retrieval.py ____________________________________________________
tests\test_retrieval.py:5: in <module>
    from hoi4_rag.retrieval import HybridSearcher
src\hoi4_rag\retrieval\__init__.py:3: in <module>
    from .hybrid_search import HybridSearcher, RetrievalError
src\hoi4_rag\retrieval\hybrid_search.py:12: in <module>
    from hoi4_rag.vectordb import LanceDBStore, SearchResult, SparseIndex
src\hoi4_rag\vectordb\__init__.py:3: in <module>
    from .lancedb_store import DocumentChunk, LanceDBStore, SearchResult
src\hoi4_rag\vectordb\lancedb_store.py:19: in <module>
    class DocumentChunk(LanceModel):
.venv\Lib\site-packages\pydantic\_internal\_model_construction.py:255: in __new__
    complete_model_class(
.venv\Lib\site-packages\pydantic\_internal\_model_construction.py:648: in complete_model_class
    schema = gen_schema.generate_schema(cls)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:729: in generate_schema
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1023: in _generate_schema_inner
    return self._model_schema(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:856: in _model_schema
    {k: self._generate_md_field_schema(k, v, decorators) for k, v in fields.items()},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1228: in _generate_md_field_schema
    schema, metadata = self._common_field_schema(name, field_info, decorators)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1282: in _common_field_schema
    schema = self._apply_annotations(
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:2227: in _apply_annotations
    schema = get_inner_schema(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_schema_generation_shared.py:83: in __call__
    schema = self._handler(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:2206: in inner_handler
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1028: in _generate_schema_inner
    return self.match_type(obj)
           ^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1148: in match_type
    return self._unknown_type_schema(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:659: in _unknown_type_schema
    raise PydanticSchemaGenerationError(
E   pydantic.errors.PydanticSchemaGenerationError: Unable to generate pydantic-core schema for TimestampType(timestamp[us]). Set `arbitrary_types_allowed=True` in the model_config to ignore this error or implement `__get_pydantic_core_schema__` on your type to fully support it.
E
E   If you got this error by calling handler(<some type>) within `__get_pydantic_core_schema__` then you likely need to call `handler.generate_schema(<some type>)` since we do not call `__get_pydantic_core_schema__` on `<some type>` otherwise to avoid infinite recursion.
E
E   For further information visit https://errors.pydantic.dev/2.12/u/schema-for-unknown-type
__________________________________________________ ERROR collecting tests/test_sparse_index.py __________________________________________________
tests\test_sparse_index.py:1: in <module>
    from hoi4_rag.vectordb import SparseIndex
src\hoi4_rag\vectordb\__init__.py:3: in <module>
    from .lancedb_store import DocumentChunk, LanceDBStore, SearchResult
src\hoi4_rag\vectordb\lancedb_store.py:19: in <module>
    class DocumentChunk(LanceModel):
.venv\Lib\site-packages\pydantic\_internal\_model_construction.py:255: in __new__
    complete_model_class(
.venv\Lib\site-packages\pydantic\_internal\_model_construction.py:648: in complete_model_class
    schema = gen_schema.generate_schema(cls)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:729: in generate_schema
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1023: in _generate_schema_inner
    return self._model_schema(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:856: in _model_schema
    {k: self._generate_md_field_schema(k, v, decorators) for k, v in fields.items()},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1228: in _generate_md_field_schema
    schema, metadata = self._common_field_schema(name, field_info, decorators)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1282: in _common_field_schema
    schema = self._apply_annotations(
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:2227: in _apply_annotations
    schema = get_inner_schema(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_schema_generation_shared.py:83: in __call__
    schema = self._handler(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:2206: in inner_handler
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1028: in _generate_schema_inner
    return self.match_type(obj)
           ^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1148: in match_type
    return self._unknown_type_schema(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:659: in _unknown_type_schema
    raise PydanticSchemaGenerationError(
E   pydantic.errors.PydanticSchemaGenerationError: Unable to generate pydantic-core schema for TimestampType(timestamp[us]). Set `arbitrary_types_allowed=True` in the model_config to ignore this error or implement `__get_pydantic_core_schema__` on your type to fully support it.
E
E   If you got this error by calling handler(<some type>) within `__get_pydantic_core_schema__` then you likely need to call `handler.generate_schema(<some type>)` since we do not call `__get_pydantic_core_schema__` on `<some type>` otherwise to avoid infinite recursion.
E
E   For further information visit https://errors.pydantic.dev/2.12/u/schema-for-unknown-type
____________________________________________________ ERROR collecting tests/test_vectordb.py ____________________________________________________
tests\test_vectordb.py:5: in <module>
    from hoi4_rag.vectordb import DocumentChunk, LanceDBStore
src\hoi4_rag\vectordb\__init__.py:3: in <module>
    from .lancedb_store import DocumentChunk, LanceDBStore, SearchResult
src\hoi4_rag\vectordb\lancedb_store.py:19: in <module>
    class DocumentChunk(LanceModel):
.venv\Lib\site-packages\pydantic\_internal\_model_construction.py:255: in __new__
    complete_model_class(
.venv\Lib\site-packages\pydantic\_internal\_model_construction.py:648: in complete_model_class
    schema = gen_schema.generate_schema(cls)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:729: in generate_schema
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1023: in _generate_schema_inner
    return self._model_schema(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:856: in _model_schema
    {k: self._generate_md_field_schema(k, v, decorators) for k, v in fields.items()},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1228: in _generate_md_field_schema
    schema, metadata = self._common_field_schema(name, field_info, decorators)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1282: in _common_field_schema
    schema = self._apply_annotations(
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:2227: in _apply_annotations
    schema = get_inner_schema(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_schema_generation_shared.py:83: in __call__
    schema = self._handler(source_type)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:2206: in inner_handler
    schema = self._generate_schema_inner(obj)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1028: in _generate_schema_inner
    return self.match_type(obj)
           ^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:1148: in match_type
    return self._unknown_type_schema(obj)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\pydantic\_internal\_generate_schema.py:659: in _unknown_type_schema
    raise PydanticSchemaGenerationError(
E   pydantic.errors.PydanticSchemaGenerationError: Unable to generate pydantic-core schema for TimestampType(timestamp[us]). Set `arbitrary_types_allowed=True` in the model_config to ignore this error or implement `__get_pydantic_core_schema__` on your type to fully support it.
E
E   If you got this error by calling handler(<some type>) within `__get_pydantic_core_schema__` then you likely need to call `handler.generate_schema(<some type>)` since we do not call `__get_pydantic_core_schema__` on `<some type>` otherwise to avoid infinite recursion.
E
E   For further information visit https://errors.pydantic.dev/2.12/u/schema-for-unknown-type
=============================================================== warnings summary ================================================================
src\hoi4_rag\vectordb\lancedb_store.py:19
src\hoi4_rag\vectordb\lancedb_store.py:19
src\hoi4_rag\vectordb\lancedb_store.py:19
src\hoi4_rag\vectordb\lancedb_store.py:19
  F:\Projects\HOI4\HOI4-RAG\src\hoi4_rag\vectordb\lancedb_store.py:19: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class DocumentChunk(LanceModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
============================================================ short test summary info ============================================================
ERROR tests/test_mcp_tools.py - pydantic.errors.PydanticSchemaGenerationError: Unable to generate pydantic-core schema for TimestampType(timestamp[us]). Set `arbitrary_types...
ERROR tests/test_retrieval.py - pydantic.errors.PydanticSchemaGenerationError: Unable to generate pydantic-core schema for TimestampType(timestamp[us]). Set `arbitrary_types...
ERROR tests/test_sparse_index.py - pydantic.errors.PydanticSchemaGenerationError: Unable to generate pydantic-core schema for TimestampType(timestamp[us]). Set `arbitrary_types...
ERROR tests/test_vectordb.py - pydantic.errors.PydanticSchemaGenerationError: Unable to generate pydantic-core schema for TimestampType(timestamp[us]). Set `arbitrary_types...
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 4 errors during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
=================================================== 4 warnings, 4 errors in 60.08s (0:01:00) ====================================================

   F:\..\HOI4-RAG  develop  venv/3.12.10 󰔟 1m 3.654s
